<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pixel Miner Pro</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --text-color: #ffffff;
            --card-bg: #16213e;
            --accent: #4ecca3;
            --boss-color: #e74c3c;
        }

        body.light-mode {
            --bg-color: #f0f2f5;
            --text-color: #1a1a2e;
            --card-bg: #ffffff;
            --accent: #2ecc71;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
            transition: 0.3s;
        }

        .header { position: absolute; top: 15px; display: flex; gap: 10px; align-items: center; width: 90%; justify-content: space-between; }
        #mine-name-display { font-size: 1rem; font-weight: bold; border-bottom: 2px dashed var(--accent); }

        .stat-box { text-align: center; margin-bottom: 15px; }
        #gold-count { font-size: 3rem; font-weight: bold; color: #f1c40f; line-height: 1; }
        .prestige-text { color: #9b59b6; font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; }

        #click-container { position: relative; margin-bottom: 15px; }
        #click-btn {
            width: 140px; height: 140px;
            border-radius: 50%; border: none;
            background: radial-gradient(#f39c12, #d35400);
            color: white; font-size: 1.1rem; font-weight: bold;
            box-shadow: 0 8px #a04000;
            transition: transform 0.05s;
            z-index: 10;
        }
        #click-btn:active { transform: scale(0.92); box-shadow: 0 2px #a04000; }

        /* Boss Mode Styling */
        #click-btn.boss-active {
            background: radial-gradient(#e74c3c, #c0392b);
            box-shadow: 0 8px #922b21;
            animation: shake 0.2s infinite;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            50% { transform: translate(-1px, -2px) rotate(-1deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }

        #boss-health-bar {
            width: 100%; height: 10px; background: #333;
            border-radius: 5px; margin-top: 10px; display: none;
        }
        #boss-health-fill {
            width: 100%; height: 100%; background: var(--boss-color);
            border-radius: 5px; transition: width 0.1s;
        }

        .upgrade-section { width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 8px; }
        .upgrade-btn {
            width: 100%; padding: 10px; background: var(--card-bg);
            border: 1px solid var(--accent); color: var(--text-color); border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .upgrade-btn:disabled { opacity: 0.3; filter: grayscale(1); }
        
        .milestone-badge { font-size: 0.7rem; background: #e74c3c; padding: 2px 5px; border-radius: 4px; margin-left: 5px; }
        .cost-tag { background: #0f3460; padding: 3px 8px; border-radius: 6px; color: #4ecca3; font-weight: bold; }

        .floating-text {
            position: absolute; color: #f1c40f; font-weight: bold; pointer-events: none;
            animation: floatUp 0.7s ease-out forwards; z-index: 100;
        }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-80px); opacity: 0; } }

        .mode-toggle { padding: 4px 10px; border-radius: 15px; border: 1px solid var(--accent); background: var(--card-bg); color: var(--text-color); font-size: 0.7rem; }
    </style>
</head>
<body class="dark-mode">

    <div class="header">
        <span id="mine-name-display" onclick="renameMine()">My Mine</span>
        <button class="mode-toggle" onclick="toggleTheme()">ðŸŒ“ Theme</button>
    </div>

    <div class="stat-box">
        <div class="prestige-text">Multiplier: x<span id="prestige-multi">1</span></div>
        <div>Gold: <span id="gold-count">0</span></div>
        <div id="boss-timer" style="color: #e74c3c; font-weight: bold; display: none;">BOSS TIME!</div>
        <div style="font-size: 1rem; color: #f1c40f;">+<span id="gps-count">0</span>/s</div>
    </div>

    <div id="click-container">
        <button id="click-btn">MINE!</button>
        <div id="boss-health-bar"><div id="boss-health-fill"></div></div>
    </div>

    <div class="upgrade-section">
        <button id="buy-clicker" class="upgrade-btn">
            <div>Pickaxe [Lvl <span id="clicker-lvl">1</span>] <span id="click-ms" class="milestone-badge" style="display:none">BONUS</span></div>
            <span id="clicker-cost" class="cost-tag">15 G</span>
        </button>

        <button id="buy-miner" class="upgrade-btn">
            <div>Miners [Lvl <span id="miner-lvl">0</span>] <span id="miner-ms" class="milestone-badge" style="display:none">BONUS</span></div>
            <span id="miner-cost" class="cost-tag">10 G</span>
        </button>

        <button id="prestige-btn" class="upgrade-btn" style="background:#4a148c; display:none;">
            <span>ASCEND</span>
            <span class="cost-tag">+1 Multi</span>
        </button>
        
        <button onclick="hardReset()" style="background:none; border:none; color:#777; font-size:10px; margin-top:5px;">Hard Reset Data</button>
    </div>

    <script>
        let gold = 0, miners = 0, minerCost = 10;
        let clickValue = 1, clickerCost = 15, prestige = 1, clickerLvl = 1;
        let mineName = "My Mine", isDarkMode = true;

        // Boss Variables
        let isBossActive = false;
        let bossHealth = 0;
        let bossMaxHealth = 50;

        const goldDisplay = document.getElementById('gold-count');
        const gpsDisplay = document.getElementById('gps-count');
        const clickBtn = document.getElementById('click-btn');
        const healthFill = document.getElementById('boss-health-fill');

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.className = isDarkMode ? "dark-mode" : "light-mode";
            saveGame();
        }

        function renameMine() {
            const n = prompt("Mine Name:", mineName);
            if(n) { mineName = n; updateUI(); saveGame(); }
        }

        function updateUI() {
            const minerBonus = Math.floor(miners / 10) + 1;
            goldDisplay.innerText = Math.floor(gold);
            gpsDisplay.innerText = (miners * prestige * minerBonus).toFixed(1);
            document.getElementById('prestige-multi').innerText = prestige;
            document.getElementById('miner-cost').innerText = minerCost + " G";
            document.getElementById('clicker-cost').innerText = clickerCost + " G";
            document.getElementById('miner-lvl').innerText = miners;
            document.getElementById('clicker-lvl').innerText = clickerLvl;
            document.getElementById('mine-name-display').innerText = mineName;
            
            document.getElementById('miner-ms').style.display = miners >= 10 ? "inline" : "none";
            document.getElementById('click-ms').style.display = clickerLvl >= 10 ? "inline" : "none";
            
            document.getElementById('buy-miner').disabled = (gold < minerCost) || isBossActive;
            document.getElementById('buy-clicker').disabled = (gold < clickerCost) || isBossActive;
            
            document.getElementById('prestige-btn').style.display = (gold >= 1000 || prestige > 1) ? "flex" : "none";
            document.getElementById('prestige-btn').disabled = (gold < 1000);
        }

        // Logic for Clicking
        clickBtn.addEventListener('click', (e) => {
            if (isBossActive) {
                bossHealth--;
                let percent = (bossHealth / bossMaxHealth) * 100;
                healthFill.style.width = percent + "%";
                if (bossHealth <= 0) winBoss();
            } else {
                const bonus = Math.floor(clickerLvl / 10) + 1;
                let gain = clickValue * prestige * bonus;
                gold += gain;
                spawnText(gain, e.clientX, e.clientY);
                updateUI();
            }
        });

        // Boss Logic
        function startBoss() {
            isBossActive = true;
            bossMaxHealth = 50 + (prestige * 20);
            bossHealth = bossMaxHealth;
            clickBtn.innerText = "BREAK IT!";
            clickBtn.classList.add('boss-active');
            document.getElementById('boss-health-bar').style.display = 'block';
            document.getElementById('boss-timer').style.display = 'block';
            healthFill.style.width = "100%";
            updateUI();
        }

        function winBoss() {
            isBossActive = false;
            let reward = 500 * prestige;
            gold += reward;
            clickBtn.innerText = "MINE!";
            clickBtn.classList.remove('boss-active');
            document.getElementById('boss-health-bar').style.display = 'none';
            document.getElementById('boss-timer').style.display = 'none';
            spawnText("BOSS DEFEATED! +" + reward, window.innerWidth/2, window.innerHeight/2, true);
            updateUI();
            saveGame();
        }

        // Trigger Boss every 2 minutes
        setInterval(() => {
            if (!isBossActive) startBoss();
        }, 120000);

        function spawnText(amt, x, y, spec) {
            const t = document.createElement('div');
            t.className = 'floating-text';
            if(spec) t.style.color = "#4ecca3";
            t.innerText = isNaN(amt) ? amt : "+" + amt;
            t.style.left = (x || window.innerWidth/2) + "px";
            t.style.top = (y || window.innerHeight/2) + "px";
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 700);
        }

        // Standard Loops
        document.getElementById('buy-clicker').addEventListener('click', () => {
            if (gold >= clickerCost) {
                gold -= clickerCost; clickerLvl++; clickValue++;
                clickerCost = Math.floor(clickerCost * 1.6);
                updateUI(); saveGame();
            }
        });

        document.getElementById('buy-miner').addEventListener('click', () => {
            if (gold >= minerCost) {
                gold -= minerCost; miners++;
                minerCost = Math.floor(minerCost * 1.25);
                updateUI(); saveGame();
            }
        });

        document.getElementById('prestige-btn').addEventListener('click', () => {
            if (confirm("Ascend?")) {
                prestige++; gold = 0; miners = 0; minerCost = 10;
                clickValue = 1; clickerCost = 15; clickerLvl = 1;
                saveGame(); updateUI();
            }
        });

        setInterval(() => {
            const minerBonus = Math.floor(miners / 10) + 1;
            gold += (miners * prestige * minerBonus);
            updateUI();
        }, 1000);

        function saveGame() {
            const data = { gold, miners, minerCost, clickValue, clickerCost, prestige, mineName, isDarkMode, clickerLvl };
            localStorage.setItem("pixelMinerV4", JSON.stringify(data));
        }

        function loadGame() {
            const saved = localStorage.getItem("pixelMinerV4");
            if(saved) {
                const d = JSON.parse(saved);
                gold = Number(d.gold) || 0; miners = Number(d.miners) || 0;
                minerCost = Number(d.minerCost) || 10; clickValue = Number(d.clickValue) || 1;
                clickerCost = Number(d.clickerCost) || 15; prestige = Number(d.prestige) || 1;
                clickerLvl = Number(d.clickerLvl) || 1; mineName = d.mineName || "My Mine";
                isDarkMode = d.isDarkMode ?? true;
                document.body.className = isDarkMode ? "dark-mode" : "light-mode";
            }
            updateUI();
        }

        function hardReset() { if(confirm("Erase EVERYTHING?")) { localStorage.clear(); location.reload(); } }

        loadGame();
    </script>
</body>
</html>
